
OFFICIAL VISIT MAPPING

   official_visit_id bigserial NOT NULL             --> GENERATED BY DPS
   prison_visit_slot_id bigint NOT NULL             --> Supplied - in migration request - from previously sent visit config data
   visit_date date NOT NULL                         --> Supplied - from NOMIS visit_date
   start_time time without time zone NOT NULL       --> Supplied - from NOMIS visit start_time
   end_time time without time zone NOT NULL         --> Supplied - from NOMIS end_time
   dps_location_id UUID NOT NULL                    --> Supplied - as mapped value for internal_location_id
   visit_status_code varchar(20) NOT NULL           --> Calculated - DPS enum (ACTIVE, CANCELLED, COMPLETED) - from NOMIS visit_sts (ref: VIS_STS) and/or event_status
   visit_type_code varchar(20) NOT NULL             --> Calculated - DPS enum (IN_PERSON, VIDEO, TELEPHONE, MIGRATED **default) - ways to map from NOMIS, video in comments?, locations? (ref: VIS_TYPE_CODE)
   prison_code varchar(10) NOT NULL                 --> Supplied - from NOMIS agy_loc_id
   prisoner_number varchar(7) NOT NULL              --> Supplied - obtained from OFFENDER_BOOK_ID
   current_term Boolean                             --> Supplied - true if this visit is against the booking_id of the current or latest term in prison
   private_notes varchar(240)                       --> ?? remove from migration - only populated in DPS
   public_notes varchar(240)                        --> Supplied - from comment_text in NOMIS
   search_type_code varchar(20)                     --> Supplied - from NOMIS search_type (ref: SEARCH_TYPE)
   visitor_concern_text varchar(240)                --> Supplied - from NOMIS visitor_concern_text
   completion_code varchar(20)                      --> Calculated - from NOMIS values in EVENT_OUTCOME and OUTCOME_REASON_CODE (ref: VIS_COMPLETE)
   override_ban_by varchar(100)                     --> Supplied - Username from NOMIS lookup of override_ban_staff_id
   override_ban_time timestamp                      --> Supplied - otherwise null from NOMIS
   created_time timestamp NOT NULL                  --> Supplied - from NOMIS create_datetime
   created_by varchar(100) NOT NULL                 --> Supplied - from NOMIS lookup of create_user_id
   updated_time timestamp                           --> Supplied or null - Time of last modify from NOMIS modify_datetime
   updated_by varchar(100)                          --> Supplied or null - Username from NOMIS lookup of modify_user_id
   offender_visit_id bigint                         --> Supplied - set to NOMIS value of offender_visit_id, or null if created in DPS
   -- No DPS value --                               --> CLIENT_UNIQUE_REF - is this used?
   -- No DPS value --                               --> OFFENDER_VISIT_ORDER_ID - UR tells us no VOs for official visits?
   -- No DPS value --                               --> RAISED_INCIDENT_TYPE, RAISED_INCIDENT_NUMBER ??


OFFICIAL VISITOR MAPPING

   official_visitor_id bigserial NOT NULL           --> GENERATED by DPS
   official_visit_id bigint NOT NULL                --> FK to visit
   visitor_type_code varchar(20) NOT NULL           --> Supplied - DPS enum(CONTACT, PRISONER, OPV) - migration defaults to CONTACT
   contact_type_code varchar(20) NOT NULL           --> Supplied - DPS enum(SOCIAL, OFFICIAL, NOT_A_CONTACT - OPV)
   contact_id bigint                                --> Supplied - person_id in NOMIS - should be present
   prisoner_contact_id bigint                       --> Not supplied - Migration service tries to establish - from name, person, and relationship? Set by DPS
   first_name varchar(60)                           --> Supplied - check against contacts?
   last_name varchar(60)                            --> Supplied - check against contacts?
   dateOfBirth date                                 --> Supplied - check against contacts?
   relationship_code varchar(20)                    --> Supplied - check against contacts?
   lead_visitor boolean NOT NULL                    --> Supplied - Group leader flag (Y/N) converted to Boolean
   assisted_visit boolean NOT NULL                  --> Supplied - Assisted visit flag (Y/N) converted to Boolean
   email_address varchar(160)                       --> ??? DPS-only - null on migrated visitors - remove?
   phone_number varchar(30)                         --> ??? DPS-only - null on migration visitors - remove?
   visitor_notes varchar(240)                       --> Supplied - From comment_text in NOMIS
   attendance_code varchar(20)                      --> Migration service maps to a value using EVENT_OUTCOME and OUTCOME_REASON_CODE (ref: ATTENDANCE_CODE)
   attendance_notes varchar(240)                    --> ??? DPS only - null on migration
   attendance_by varchar(100)                       --> ??? DPS only - null on migration
   attendance_time timestamp                        --> ??? DPS only - null on migration
   created_time timestamp NOT NULL                  --> Supplied - Time of creation from NOMIS create_datetime
   created_by varchar(100) NOT NULL                 --> Supplied - Username from NOMIS lookup of create_user_id
   updated_time timestamp                           --> Supplied or null - Time of last modify from NOMIS modify_datetime
   updated_by varchar(100)                          --> Supplied of null - Username from NOMIS lookup of modify_user_id
   offender_visit_visitor_id bigint                 --> For migrated visits - set to the original ID in NOMIS
   -- no DPS value --                               --> EVENT_STATUS in NOMIS - any value in keeping? (canc visitors?)
   -- no DPS value --                               --> EVENT_ID in NOMIS - any value in keeping?


   QUESTIONS

   * Approval to visit is held against the relationship between an offender and a person, but an official visit does
     not contain a reference to the relationship, only to the person ID. Is this booking_id/person_id always a unique combination?

   * Could the same person id be in multiple relationships with a prisoner spanning multiple bookings?
     If so - we couldn't narrow it down to which relationship was related to which visit - we'd only know the person.
     This might be OK?

   * Will current_term=false allow us to see which person was the approved visitor for a previous booking? If there
     are multiple relationships between contact and prisoner we probably can't narrow it down? Should we just accept
     that we might need the booking_id for visits temporarily, whilst NOMIS is present in the sync?

   * Going forward, at the time a visit is booked, we CAN know the person and the relationship, and record this on
     the visit booking.

